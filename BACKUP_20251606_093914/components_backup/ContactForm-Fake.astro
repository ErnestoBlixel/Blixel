---
// Componente de formulario de contacto nativo para Astro
// src/components/ContactForm.astro
---

<div class="contact-form-wrapper">
  <form id="contact-form" class="gravity-form" action="#" method="POST">
    <div class="gform-fields">
      <!-- Nombre -->
      <div class="gfield">
        <label for="name">Nombre completo <span class="required">*</span></label>
        <input 
          type="text" 
          id="name" 
          name="name" 
          placeholder="Tu nombre completo"
          required 
          class="form-input" 
        />
      </div>

      <!-- Email -->
      <div class="gfield">
        <label for="email">Email <span class="required">*</span></label>
        <input 
          type="email" 
          id="email" 
          name="email" 
          placeholder="tu@email.com"
          required 
          class="form-input" 
        />
      </div>

      <!-- Teléfono -->
      <div class="gfield">
        <label for="phone">Teléfono</label>
        <input 
          type="tel" 
          id="phone" 
          name="phone" 
          placeholder="+34 123 456 789"
          class="form-input" 
        />
      </div>

      <!-- Empresa -->
      <div class="gfield">
        <label for="company">Empresa <span class="required">*</span></label>
        <input 
          type="text" 
          id="company" 
          name="company" 
          placeholder="Nombre de tu empresa"
          required 
          class="form-input" 
        />
      </div>

      <!-- Sector -->
      <div class="gfield">
        <label for="sector">Sector de tu empresa</label>
        <select id="sector" name="sector" class="form-select">
          <option value="">Selecciona tu sector</option>
          <option value="retail">Retail / Comercio</option>
          <option value="servicios">Servicios profesionales</option>
          <option value="manufactura">Manufactura / Industria</option>
          <option value="tecnologia">Tecnología</option>
          <option value="salud">Salud / Medicina</option>
          <option value="educacion">Educación</option>
          <option value="inmobiliaria">Inmobiliaria</option>
          <option value="hosteleria">Hostelería / Turismo</option>
          <option value="logistica">Logística / Transporte</option>
          <option value="financiero">Financiero / Seguros</option>
          <option value="otro">Otro</option>
        </select>
      </div>

      <!-- Tamaño de empresa -->
      <div class="gfield">
        <label for="company-size">Tamaño de la empresa</label>
        <select id="company-size" name="company_size" class="form-select">
          <option value="">Selecciona el tamaño</option>
          <option value="1-10">1-10 empleados</option>
          <option value="11-50">11-50 empleados</option>
          <option value="51-200">51-200 empleados</option>
          <option value="201-1000">201-1000 empleados</option>
          <option value="1000+">Más de 1000 empleados</option>
        </select>
      </div>

      <!-- Servicios de interés -->
      <div class="gfield">
        <label>¿Qué servicios te interesan? <span class="required">*</span></label>
        <div class="checkbox-group">
          <div class="gchoice">
            <input type="checkbox" id="service-training" name="services[]" value="formacion" />
            <label for="service-training">Formación en IA para equipos</label>
          </div>
          <div class="gchoice">
            <input type="checkbox" id="service-automation" name="services[]" value="automatizacion" />
            <label for="service-automation">Automatización de procesos</label>
          </div>
          <div class="gchoice">
            <input type="checkbox" id="service-agents" name="services[]" value="agentes" />
            <label for="service-agents">Agentes IA automatizados 24/7</label>
          </div>
          <div class="gchoice">
            <input type="checkbox" id="service-saas" name="services[]" value="desarrollo" />
            <label for="service-saas">Desarrollo SaaS con IA</label>
          </div>
          <div class="gchoice">
            <input type="checkbox" id="service-consulting" name="services[]" value="consultoria" />
            <label for="service-consulting">Consultoría estratégica en IA</label>
          </div>
        </div>
      </div>

      <!-- Mensaje -->
      <div class="gfield">
        <label for="message">Cuéntanos sobre tu proyecto <span class="required">*</span></label>
        <textarea 
          id="message" 
          name="message" 
          placeholder="Describe brevemente qué necesitas y cómo podemos ayudarte..."
          required 
          rows="4"
          class="form-textarea"
        ></textarea>
      </div>

      <!-- Presupuesto estimado -->
      <div class="gfield">
        <label for="budget">Presupuesto estimado</label>
        <select id="budget" name="budget" class="form-select">
          <option value="">Selecciona un rango</option>
          <option value="menos-5k">Menos de 5.000€</option>
          <option value="5k-15k">5.000€ - 15.000€</option>
          <option value="15k-30k">15.000€ - 30.000€</option>
          <option value="30k-50k">30.000€ - 50.000€</option>
          <option value="50k-100k">50.000€ - 100.000€</option>
          <option value="mas-100k">Más de 100.000€</option>
          <option value="no-definido">Aún no lo tengo definido</option>
        </select>
      </div>

      <!-- Timeline -->
      <div class="gfield">
        <label for="timeline">¿Cuándo necesitas implementar la solución?</label>
        <select id="timeline" name="timeline" class="form-select">
          <option value="">Selecciona un plazo</option>
          <option value="inmediato">Lo antes posible</option>
          <option value="1-mes">En el próximo mes</option>
          <option value="2-3-meses">En 2-3 meses</option>
          <option value="6-meses">En los próximos 6 meses</option>
          <option value="mas-6-meses">En más de 6 meses</option>
          <option value="explorando">Solo estoy explorando opciones</option>
        </select>
      </div>

      <!-- Consentimiento RGPD -->
      <div class="gfield consent-field">
        <div class="gchoice">
          <input type="checkbox" id="consent" name="consent" value="1" required />
          <label for="consent">
            Acepto el tratamiento de mis datos personales según la 
            <a href="/politica-privacidad" target="_blank" rel="noopener">Política de Privacidad</a> 
            y autorizo el contacto comercial por parte de Blixel. <span class="required">*</span>
          </label>
        </div>
      </div>

      <!-- Comunicaciones -->
      <div class="gfield">
        <div class="gchoice">
          <input type="checkbox" id="newsletter" name="newsletter" value="1" />
          <label for="newsletter">
            Quiero recibir información sobre novedades en IA y casos de éxito (opcional)
          </label>
        </div>
      </div>
    </div>

    <div class="gform-footer">
      <button type="submit" class="gform-submit">
        <span class="button-text">Solicitar consulta gratuita</span>
        <span class="button-loading" style="display: none;">Enviando...</span>
      </button>
    </div>

    <div class="form-message" style="display: none;"></div>
  </form>
</div>

<style>
  .contact-form-wrapper {
    position: relative;
  }

  .gravity-form {
    display: grid;
    gap: 1.5rem;
  }

  .gfield {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .gravity-form label {
    font-size: 0.9rem;
    font-weight: 600;
    color: #e5e7eb;
    margin-bottom: 0.5rem;
  }

  .required {
    color: #ef4444;
  }

  .form-input,
  .form-textarea,
  .form-select {
    width: 100%;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    color: #ffffff;
    font-size: 1rem;
    transition: all 0.3s ease;
    font-family: inherit;
  }

  .form-input:focus,
  .form-textarea:focus,
  .form-select:focus {
    outline: none;
    border-color: #60a5fa;
    background: rgba(255, 255, 255, 0.08);
    box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
  }

  .form-input::placeholder,
  .form-textarea::placeholder {
    color: #6b7280;
  }

  .form-textarea {
    resize: vertical;
    min-height: 120px;
  }

  .checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-top: 0.5rem;
  }

  .gchoice {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
  }

  .gchoice input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: #60a5fa;
    margin-top: 2px;
    flex-shrink: 0;
  }

  .gchoice label {
    margin: 0;
    font-weight: 400;
    color: #d1d5db;
    cursor: pointer;
    line-height: 1.4;
    font-size: 0.9rem;
  }

  .gchoice label a {
    color: #60a5fa;
    text-decoration: none;
  }

  .gchoice label a:hover {
    text-decoration: underline;
  }

  .consent-field .gchoice label {
    font-size: 0.85rem;
    color: #9ca3af;
  }

  .gform-submit {
    width: 100%;
    padding: 1.25rem 2rem;
    background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
    color: white;
    font-weight: 600;
    font-size: 1.125rem;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 1rem;
    position: relative;
    overflow: hidden;
  }

  .gform-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(96, 165, 250, 0.3);
  }

  .gform-submit:active {
    transform: translateY(0);
  }

  .gform-submit:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
  }

  .button-loading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  .form-message {
    padding: 1rem;
    border-radius: 8px;
    margin-top: 1rem;
    font-weight: 500;
  }

  .form-message.success {
    background: rgba(34, 197, 94, 0.1);
    border: 1px solid rgba(34, 197, 94, 0.2);
    color: #22c55e;
  }

  .form-message.error {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.2);
    color: #ef4444;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .gravity-form {
      gap: 1.25rem;
    }

    .form-input,
    .form-textarea,
    .form-select {
      padding: 0.875rem;
      font-size: 0.95rem;
    }

    .gform-submit {
      padding: 1rem 1.5rem;
      font-size: 1rem;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contact-form');
    if (!form) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitButton = form.querySelector('.gform-submit');
      const buttonText = submitButton.querySelector('.button-text');
      const buttonLoading = submitButton.querySelector('.button-loading');
      const messageDiv = form.querySelector('.form-message');
      
      // Estado de carga
      submitButton.disabled = true;
      buttonText.style.display = 'none';
      buttonLoading.style.display = 'block';
      messageDiv.style.display = 'none';
      
      // Recopilar datos del formulario
      const formData = new FormData(form);
      
      // Validar servicios seleccionados
      const services = formData.getAll('services[]');
      if (services.length === 0) {
        showMessage('Por favor, selecciona al menos un servicio de interés.', 'error');
        resetButton();
        return;
      }
      
      // Preparar datos para enviar
      const data = {
        name: formData.get('name'),
        email: formData.get('email'),
        phone: formData.get('phone'),
        company: formData.get('company'),
        sector: formData.get('sector'),
        company_size: formData.get('company_size'),
        services: services.join(', '),
        message: formData.get('message'),
        budget: formData.get('budget'),
        timeline: formData.get('timeline'),
        consent: formData.get('consent'),
        newsletter: formData.get('newsletter') ? 'Sí' : 'No',
        timestamp: new Date().toISOString(),
        source: 'Formulario web Blixel'
      };
      
      try {
        // Simular envío exitoso por ahora
        // Aquí integrarías con tu backend o servicio de email
        
        // Para desarrollo, simplemente simula éxito
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // Mostrar éxito
        showMessage(
          '¡Gracias! Hemos recibido tu solicitud y te responderemos en menos de 24 horas con un plan personalizado para tu empresa.',
          'success'
        );
        
        // Limpiar formulario
        form.reset();
        
        // Analytics/tracking opcional
        if (typeof gtag !== 'undefined') {
          gtag('event', 'form_submit', {
            event_category: 'Contact',
            event_label: 'Contact Form'
          });
        }
        
      } catch (error) {
        console.error('Error enviando formulario:', error);
        showMessage(
          'Ha ocurrido un error al enviar tu mensaje. Por favor, inténtalo de nuevo o escríbenos directamente a info@blixel.es',
          'error'
        );
      } finally {
        resetButton();
      }
      
      function resetButton() {
        submitButton.disabled = false;
        buttonText.style.display = 'block';
        buttonLoading.style.display = 'none';
      }
      
      function showMessage(text, type) {
        messageDiv.textContent = text;
        messageDiv.className = `form-message ${type}`;
        messageDiv.style.display = 'block';
        
        // Scroll al mensaje
        messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    });
    
    // Validación en tiempo real para email
    const emailInput = form.querySelector('#email');
    if (emailInput) {
      emailInput.addEventListener('blur', (e) => {
        const email = e.target.value;
        if (email && !isValidEmail(email)) {
          e.target.style.borderColor = '#ef4444';
        } else {
          e.target.style.borderColor = '';
        }
      });
    }
    
    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }
  });
</script>
