---
import Layout from '../layouts/Layout.astro';

// Query para obtener la p치gina de inicio configurada en WordPress
const GQL = `
  query GetHomePage {
    readingSettings {
      pageOnFront
    }
    page(id: "front-page", idType: URI) {
      title
      content
    }
  }
`;

// 2) Haz el fetch usando la variable de entorno
const graphqlUrl = import.meta.env.PUBLIC_WP_GRAPHQL_URL;
if (!graphqlUrl) {
  throw new Error('PUBLIC_WP_GRAPHQL_URL no est치 configurada');
}

const res = await fetch(graphqlUrl, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ query: GQL })
});

if (!res.ok) throw new Error(`Error GraphQL: ${res.status}`);

const result = await res.json();
console.log('GraphQL Response:', result);

// Verificar si hay errores en la respuesta
if (result.errors) {
  console.error('GraphQL Errors:', result.errors);
  throw new Error(`GraphQL Error: ${result.errors[0].message}`);
}

// Verificar si tenemos data
if (!result.data) {
  throw new Error('No data returned from GraphQL');
}

// 3) Extrae de "data" lo que necesites
const home = result.data.page;

// Si no existe, usar datos por defecto
const pageData = home || {
  title: "Blixel AI - Automatizaci칩n Inteligente",
  content: "<p>Transformamos tu empresa con Inteligencia Artificial y automatizaci칩n avanzada.</p>"
};
---

<!-- 4) Ahora ya en el template puedes renderizar -->
<Layout>
  <h1>{pageData.title}</h1>
  <div innerHTML={pageData.content} />
</Layout>
