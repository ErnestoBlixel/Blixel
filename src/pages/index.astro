---
import Layout from '../layouts/Layout.astro';

// Query espec√≠fico para buscar la p√°gina "inicio"
const GQL = `
  query GetHomePage {
    page(id: "inicio", idType: URI) {
      title
      content
      databaseId
    }
  }
`;

// 2) Haz el fetch usando la variable de entorno
const graphqlUrl = import.meta.env.PUBLIC_WP_GRAPHQL_URL;
console.log('üåê Usando GraphQL URL:', graphqlUrl);

if (!graphqlUrl) {
  throw new Error('PUBLIC_WP_GRAPHQL_URL no est√° configurada');
}

const res = await fetch(graphqlUrl, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ query: GQL })
});

if (!res.ok) throw new Error(`Error GraphQL: ${res.status}`);

const result = await res.json();
console.log('üìä GraphQL Response:', JSON.stringify(result, null, 2));

// Verificar si hay errores en la respuesta
if (result.errors) {
  console.error('‚ùå GraphQL Errors:', result.errors);
  throw new Error(`GraphQL Error: ${result.errors[0].message}`);
}

// Verificar si tenemos data
if (!result.data) {
  throw new Error('No data returned from GraphQL');
}

// 3) Usar la p√°gina "inicio" o datos por defecto
const home = result.data.page;

console.log('‚úÖ P√°gina "inicio" encontrada:', home ? { id: home.databaseId, title: home.title } : 'No encontrada');

// Si existe la p√°gina "inicio", usarla; si no, datos por defecto
const pageData = home || {
  title: "Blixel AI - Automatizaci√≥n Inteligente para tu Empresa",
  content: `
    <p>Transformamos tu empresa con <strong>Inteligencia Artificial</strong> y automatizaci√≥n avanzada.</p>
    <p>Descubre c√≥mo nuestras soluciones pueden optimizar tus procesos empresariales y aumentar tu productividad.</p>
  `
};

console.log('üéØ Datos finales a mostrar:', { title: pageData.title });
---

<!-- 4) Renderizar el contenido -->
<Layout>
  <h1>{pageData.title}</h1>
  <div innerHTML={pageData.content} />
  
  <!-- Debug info (solo visible en desarrollo) -->
  {import.meta.env.DEV && (
    <div style="background: #f0f0f0; padding: 20px; margin-top: 20px; border-radius: 8px;">
      <h3>üîç Debug Info:</h3>
      <p><strong>GraphQL URL:</strong> {graphqlUrl}</p>
      <p><strong>P√°gina encontrada:</strong> {home ? `‚úÖ "${home.title}" (ID: ${home.databaseId})` : '‚ùå No encontrada'}</p>
      <p><strong>T√≠tulo mostrado:</strong> {pageData.title}</p>
    </div>
  )}
</Layout>
