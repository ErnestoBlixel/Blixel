---
import Layout from '../layouts/Layout.astro';

// Query específico para buscar la página "inicio"
const GQL = `
  query GetHomePage {
    page(id: "inicio", idType: URI) {
      title
      content
      databaseId
    }
  }
`;

// 2) Haz el fetch usando la variable de entorno
const graphqlUrl = import.meta.env.PUBLIC_WP_GRAPHQL_URL;

if (!graphqlUrl) {
  throw new Error('PUBLIC_WP_GRAPHQL_URL no está configurada');
}

const res = await fetch(graphqlUrl, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ query: GQL })
});

if (!res.ok) throw new Error(`Error GraphQL: ${res.status}`);

const result = await res.json();

// Verificar si hay errores en la respuesta
if (result.errors) {
  console.error('❌ GraphQL Errors:', result.errors);
  throw new Error(`GraphQL Error: ${result.errors[0].message}`);
}

// Verificar si tenemos data
if (!result.data) {
  throw new Error('No data returned from GraphQL');
}

// 3) Usar la página "inicio" o datos por defecto
const home = result.data.page;

// Si existe la página "inicio", usarla; si no, datos por defecto
const pageData = home || {
  title: "Blixel AI - Automatización Inteligente para tu Empresa",
  content: `
    <p>Transformamos tu empresa con <strong>Inteligencia Artificial</strong> y automatización avanzada.</p>
    <p>Descubre cómo nuestras soluciones pueden optimizar tus procesos empresariales y aumentar tu productividad.</p>
  `
};
---

<!-- 4) Renderizar el contenido -->
<Layout>
  <h1>{pageData.title}</h1>
  <div innerHTML={pageData.content} />
</Layout>
