---
import { getAllPages } from '../lib/wordpress';
import Layout from '../layouts/Layout.astro';

let pages = [];
let error = null;

try {
  pages = await getAllPages();
} catch (e) {
  error = e.message;
}

const logoUrl = '/logos/LOGO AZUL BLIXEL .png';
---

<Layout 
  logoUrl={logoUrl} 
  logoAlt="BLIXEL logo"
  title="Debug: P√°ginas de WordPress"
  description="Lista de p√°ginas disponibles desde WordPress"
>
  <div style="padding: 2rem; max-width: 1200px; margin: 0 auto;">
    <h1>üîç Debug: P√°ginas de WordPress</h1>
    
    {error ? (
      <div style="background: #fee; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
        <h2>‚ùå Error al conectar con WordPress:</h2>
        <pre>{error}</pre>
      </div>
    ) : (
      <>
        <p>Total de p√°ginas encontradas: <strong>{pages.length}</strong></p>
        
        <h2>üìÑ P√°ginas disponibles:</h2>
        <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
          <thead>
            <tr style="background: #f0f0f0;">
              <th style="padding: 0.5rem; text-align: left; border: 1px solid #ddd;">T√≠tulo</th>
              <th style="padding: 0.5rem; text-align: left; border: 1px solid #ddd;">Slug</th>
              <th style="padding: 0.5rem; text-align: left; border: 1px solid #ddd;">URL</th>
              <th style="padding: 0.5rem; text-align: left; border: 1px solid #ddd;">Modificado</th>
            </tr>
          </thead>
          <tbody>
            {pages.map((page) => (
              <tr>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">{page.title}</td>
                <td style="padding: 0.5rem; border: 1px solid #ddd; font-family: monospace;">{page.slug}</td>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">
                  <a href={`/${page.slug}`} target="_blank" style="color: blue;">
                    /{page.slug}
                  </a>
                </td>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">
                  {new Date(page.modified).toLocaleDateString()}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
        
        <h2 style="margin-top: 2rem;">üîé Buscando "formacion-ia-empresas"...</h2>
        {pages.find(p => p.slug === 'formacion-ia-empresas') ? (
          <div style="background: #efe; padding: 1rem; border-radius: 8px;">
            <p>‚úÖ <strong>¬°P√°gina encontrada!</strong></p>
            <p>La p√°gina existe en WordPress y deber√≠a estar disponible en: 
              <a href="/formacion-ia-empresas" style="color: blue;">/formacion-ia-empresas</a>
            </p>
          </div>
        ) : (
          <div style="background: #ffe; padding: 1rem; border-radius: 8px;">
            <p>‚ö†Ô∏è <strong>P√°gina no encontrada</strong></p>
            <p>La p√°gina "formacion-ia-empresas" no aparece en la lista de p√°ginas de WordPress.</p>
            <p>Verifica en WordPress que:</p>
            <ul>
              <li>La p√°gina est√© publicada (no en borrador)</li>
              <li>El slug sea exactamente "formacion-ia-empresas"</li>
              <li>No sea un Custom Post Type</li>
            </ul>
          </div>
        )}
        
        <h2 style="margin-top: 2rem;">üìù P√°ginas con "formacion" en el t√≠tulo o slug:</h2>
        {(() => {
          const formacionPages = pages.filter(p => 
            p.slug.includes('formacion') || 
            p.title.toLowerCase().includes('formacion')
          );
          
          if (formacionPages.length > 0) {
            return (
              <ul>
                {formacionPages.map(page => (
                  <li>
                    <strong>{page.title}</strong> ‚Üí <code>{page.slug}</code>
                  </li>
                ))}
              </ul>
            );
          } else {
            return <p>No se encontraron p√°ginas con "formacion" en el t√≠tulo o slug.</p>;
          }
        })()}
      </>
    )}
    
    <hr style="margin: 2rem 0;" />
    
    <h2>üõ†Ô∏è Informaci√≥n de debug:</h2>
    <ul>
      <li>GraphQL URL: <code>{import.meta.env.PUBLIC_WP_GRAPHQL_URL || 'https://cms.blixel.es/graphql'}</code></li>
      <li>Fecha actual: {new Date().toLocaleString()}</li>
      <li>Modo: {import.meta.env.MODE}</li>
    </ul>
  </div>
</Layout>

<style>
  body {
    font-family: system-ui, -apple-system, sans-serif;
    line-height: 1.6;
    color: #333;
    background: white;
  }
  
  code {
    background: #f0f0f0;
    padding: 0.2em 0.4em;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
  }
  
  pre {
    background: #f0f0f0;
    padding: 1rem;
    border-radius: 4px;
    overflow-x: auto;
  }
</style>
