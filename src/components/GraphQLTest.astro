---
// Componente de prueba para verificar la estructura de GraphQL
const graphqlUrl = import.meta.env.PUBLIC_WP_GRAPHQL_URL;

// Query de introspección para ver qué campos tiene GfForm
const INTROSPECTION_QUERY = `
  query IntrospectGfForm {
    __type(name: "GfForm") {
      name
      fields {
        name
        type {
          name
          kind
        }
      }
    }
  }
`;

// Query simple para probar
const SIMPLE_QUERY = `
  query TestGravityForm {
    gfForm(id: 1, idType: DATABASE_ID) {
      id
      title
      description
    }
  }
`;

let introspectionResult = null;
let simpleResult = null;
let error = null;

if (graphqlUrl) {
  try {
    // Prueba de introspección
    const introspectionResponse = await fetch(graphqlUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ query: INTROSPECTION_QUERY })
    });

    if (introspectionResponse.ok) {
      introspectionResult = await introspectionResponse.json();
    }

    // Prueba simple
    const simpleResponse = await fetch(graphqlUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ query: SIMPLE_QUERY })
    });

    if (simpleResponse.ok) {
      simpleResult = await simpleResponse.json();
    }
  } catch (err) {
    error = err.message;
  }
}
---

<section class="graphql-test">
  <div class="container">
    <h2>Prueba de GraphQL para Gravity Forms</h2>
    
    <div class="test-section">
      <h3>URL de GraphQL</h3>
      <code>{graphqlUrl || 'No configurada'}</code>
    </div>

    {error && (
      <div class="test-section error">
        <h3>Error de conexión</h3>
        <pre>{error}</pre>
      </div>
    )}

    {introspectionResult && (
      <div class="test-section">
        <h3>Campos disponibles en GfForm</h3>
        <pre>{JSON.stringify(introspectionResult, null, 2)}</pre>
      </div>
    )}

    {simpleResult && (
      <div class="test-section">
        <h3>Resultado de consulta simple</h3>
        <pre>{JSON.stringify(simpleResult, null, 2)}</pre>
      </div>
    )}

    <div class="test-section">
      <h3>Recomendaciones</h3>
      <ul>
        <li>Verifica que el plugin WPGraphQL for Gravity Forms esté instalado y activo</li>
        <li>Asegúrate de que el formulario con ID 1 existe en Gravity Forms</li>
        <li>Revisa los permisos de GraphQL en WordPress</li>
      </ul>
    </div>
  </div>
</section>

<style>
  .graphql-test {
    background: #1a1a1a;
    color: #e5e5e5;
    padding: 2rem;
    margin: 2rem 0;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
  }

  h2 {
    color: #60a5fa;
    margin-bottom: 2rem;
  }

  h3 {
    color: #a855f7;
    margin-bottom: 1rem;
  }

  .test-section {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .test-section.error {
    border-color: #ef4444;
    background: rgba(239, 68, 68, 0.1);
  }

  code, pre {
    background: #000;
    padding: 0.5rem;
    border-radius: 4px;
    font-family: monospace;
    font-size: 0.875rem;
    overflow-x: auto;
  }

  ul {
    list-style: disc;
    padding-left: 1.5rem;
  }

  li {
    margin-bottom: 0.5rem;
  }
</style>
