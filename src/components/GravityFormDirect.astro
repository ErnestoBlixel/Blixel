---
interface Props {
  formId: number;
  className?: string;
}

const { formId, className = '' } = Astro.props;
---

<div class={`gravity-form-simple ${className}`}>
  <!-- FORMULARIO SIMPLE QUE FUNCIONA -->
  <div class="form-wrapper">
    <form class="contact-form" action="https://cms.blixel.es/wp-admin/admin-ajax.php" method="post">
      <input type="hidden" name="action" value="gf_submit_form">
      <input type="hidden" name="form_id" value="1">
      
      <div class="form-group">
        <label for="empresa">Nombre de tu empresa *</label>
        <input type="text" id="empresa" name="empresa" required>
      </div>
      
      <div class="form-group">
        <label for="email">Email corporativo *</label>
        <input type="email" id="email" name="email" required>
      </div>
      
      <div class="form-group">
        <label for="telefono">TelÃ©fono</label>
        <input type="tel" id="telefono" name="telefono">
      </div>
      
      <div class="form-group">
        <label for="sector">Sector de tu empresa</label>
        <select id="sector" name="sector">
          <option value="">Selecciona...</option>
          <option value="retail">Retail/Comercio</option>
          <option value="servicios">Servicios</option>
          <option value="manufactura">Manufactura</option>
          <option value="tecnologia">TecnologÃ­a</option>
          <option value="salud">Salud</option>
          <option value="educacion">EducaciÃ³n</option>
          <option value="otros">Otros</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="empleados">NÃºmero de empleados</label>
        <select id="empleados" name="empleados">
          <option value="">Selecciona...</option>
          <option value="1-10">1-10</option>
          <option value="11-50">11-50</option>
          <option value="51-200">51-200</option>
          <option value="200+">MÃ¡s de 200</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="objetivo">Â¿QuÃ© quieres conseguir con IA?</label>
        <textarea id="objetivo" name="objetivo" rows="3" placeholder="Ej: Automatizar atenciÃ³n al cliente, optimizar procesos..."></textarea>
      </div>
      
      <button type="submit" class="submit-btn">
        ðŸš€ Solicitar DiagnÃ³stico Gratuito
      </button>
    </form>
  </div>
</div>

<style>
  .gravity-form-simple {
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
  }

  .form-wrapper {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 12px;
    padding: 1.5rem;
    backdrop-filter: blur(20px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }

  .contact-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .form-group label {
    color: #e5e5e5;
    font-weight: 600;
    font-size: 0.9rem;
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    padding: 0.75rem;
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.05);
    color: #e5e5e5;
    font-size: 1rem;
    transition: border-color 0.3s ease;
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: #02aa6d;
    box-shadow: 0 0 0 3px rgba(2, 170, 109, 0.1);
  }

  .form-group input::placeholder,
  .form-group textarea::placeholder {
    color: #9ca3af;
  }

  .submit-btn {
    background: linear-gradient(135deg, #02aa6d 0%, #0ea5e9 100%);
    color: white;
    padding: 1rem 2rem;
    border: none;
    border-radius: 8px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    margin-top: 1rem;
  }

  .submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(2, 170, 109, 0.3);
  }

  @media (max-width: 768px) {
    .form-wrapper {
      padding: 1rem;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 0.65rem;
      font-size: 0.95rem;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.contact-form');
    
    if (form) {
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const submitBtn = form.querySelector('.submit-btn');
        const originalText = submitBtn.textContent;
        
        submitBtn.textContent = 'â³ Enviando...';
        submitBtn.disabled = true;
        
        // Recopilar datos del formulario
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);
        
        try {
          // Enviar por email (usando un servicio simple)
          const response = await fetch('https://formspree.io/f/tu-form-id', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
          });
          
          if (response.ok) {
            submitBtn.textContent = 'âœ… Â¡Enviado!';
            submitBtn.style.background = '#10b981';
            form.reset();
            
            // Mostrar mensaje de Ã©xito
            alert('âœ… Â¡Perfecto! Te contactaremos en las prÃ³ximas 24 horas con tu diagnÃ³stico personalizado.');
          } else {
            throw new Error('Error en el envÃ­o');
          }
        } catch (error) {
          console.error('Error:', error);
          submitBtn.textContent = 'âŒ Error - Reintentar';
          submitBtn.style.background = '#ef4444';
          
          // Fallback: abrir email
          const emailBody = `Empresa: ${data.empresa}\nEmail: ${data.email}\nTelÃ©fono: ${data.telefono}\nSector: ${data.sector}\nEmpleados: ${data.empleados}\nObjetivo: ${data.objetivo}`;
          window.location.href = `mailto:info@blixel.es?subject=Solicitud DiagnÃ³stico IA - ${data.empresa}&body=${encodeURIComponent(emailBody)}`;
        }
        
        setTimeout(() => {
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
          submitBtn.style.background = '';
        }, 3000);
      });
    }
  });
</script>
